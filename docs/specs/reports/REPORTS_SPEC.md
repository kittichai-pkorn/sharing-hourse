# Reports Spec (รายงาน)

## ภาพรวม

ระบบรายงานแสดงข้อมูลการเงินของวงแชร์ โดยสามารถดูได้ 2 มุมมอง:
- **รายวง** - ดูยอดรวมของแต่ละวงแชร์
- **รายคน** - ดูยอดรวมของแต่ละสมาชิก

---

## ข้อมูลหลัก (Key Metrics)

| Field | ชื่อไทย | คำอธิบาย |
|-------|---------|----------|
| `totalReceived` | ยอดรับ | เงินที่ได้รับจากการเปีย |
| `totalPaid` | ยอดส่ง | เงินที่ส่งให้วงแชร์ |
| `totalOutstanding` | ค้างจ่าย | เงินที่ยังไม่ได้ชำระ |
| `paymentRate` | อัตราชำระ | เปอร์เซ็นต์ที่ชำระแล้ว |
| `overdueCount` | จำนวนค้าง | จำนวนรายการที่ค้างจ่าย |
| `overdueDays` | วันเกินกำหนด | จำนวนวันที่เลยกำหนดชำระ |

---

## 1. หน้า Dashboard

### 1.1 ภาพรวมทั้งหมด

แสดงยอดรวมของท้าวทุกวง:

```
┌──────────────────────────────────┐
│  ยอดรับ          ยอดส่ง          │
│  ฿45,600        ฿38,400         │
│                                  │
│  ค้างจ่าย                        │
│  ฿7,200 (3 รายการ)              │
└──────────────────────────────────┘
```

### 1.2 การคำนวณ

```
ยอดรับรวม = SUM(ยอดรับของท้าวจากทุกวง)
ยอดส่งรวม = SUM(ยอดที่เก็บได้จากลูกแชร์ทุกวง)
ค้างจ่ายรวม = SUM(ยอดที่ยังไม่ได้ชำระจากทุกวง)
```

### 1.3 ค้างจ่ายล่าสุด

แสดงรายการค้างจ่าย เรียงตามวันเกินกำหนด (มากสุดก่อน):

| Field | Description |
|-------|-------------|
| ชื่อสมาชิก | ผู้ที่ค้างจ่าย |
| ชื่อวง | วงที่ค้างจ่าย |
| งวดที่ | งวดที่ค้างจ่าย |
| ยอดค้าง | จำนวนเงินที่ค้าง |
| วันเกินกำหนด | จำนวนวันที่เลยกำหนด |

---

## 2. รายงานรายวง (By Group)

### 2.1 รายการวง

แสดงทุกวงที่ท้าวเป็นเจ้าของ:

| Field | Description |
|-------|-------------|
| ชื่อวง | ชื่อวงแชร์ |
| ประเภท | STEP_INTEREST / FIXED_INTEREST / BID_INTEREST |
| จำนวนมือ | จำนวนสมาชิกในวง |
| งวดปัจจุบัน | งวดที่ X / งวดทั้งหมด |
| สถานะ | กำลังดำเนินการ / จบแล้ว |
| ยอดรับ | ยอดที่ท้าวได้รับ |
| ยอดส่ง | ยอดที่เก็บได้ทั้งหมด |
| ค้างจ่าย | ยอดที่ยังไม่ได้ชำระ |

### 2.2 Filter

- ทั้งหมด
- กำลังดำเนินการ
- จบแล้ว

### 2.3 รายละเอียดวง

#### Tab รายงวด

แสดงยอดแต่ละงวด:

| Field | Description |
|-------|-------------|
| งวดที่ | ลำดับงวด |
| ผู้เปีย | ชื่อผู้ที่ได้รับเงิน |
| ยอดเก็บ | เงินกองกลางที่เก็บได้ |
| หักท้าย/ดอก | ยอดที่หักจากผู้เปีย |
| ยอดรับ | ยอดสุทธิที่ผู้เปียได้รับ |
| สถานะ | จบแล้ว / กำลังดำเนินการ / รอ |
| ค้างจ่าย | รายชื่อและยอดที่ค้าง |

#### Tab รายคน

แสดงยอดแต่ละสมาชิก:

| Field | Description |
|-------|-------------|
| ชื่อ | ชื่อสมาชิก |
| บทบาท | ท้าว / ลูกแชร์ |
| งวดที่เปีย | งวดที่สมาชิกได้รับ |
| ยอดส่ง | รวมที่ส่งมาแล้ว |
| ยอดรับ | รวมที่ได้รับแล้ว |
| ค้างจ่าย | ยอดและงวดที่ค้าง |
| สถานะ | ครบ / ค้าง |

---

## 3. รายงานรายคน (By Member)

### 3.1 รายการสมาชิก

แสดงทุกสมาชิกที่เล่นในวงของท้าว:

| Field | Description |
|-------|-------------|
| ชื่อ | ชื่อสมาชิก |
| จำนวนวง | จำนวนวงที่เล่น |
| จำนวนมือ | จำนวนมือรวมทุกวง |
| ยอดส่งรวม | รวมที่ส่งมาแล้ว (ทุกวง) |
| ยอดรับรวม | รวมที่ได้รับแล้ว (ทุกวง) |
| ค้างจ่าย | ยอดและจำนวนงวดที่ค้าง |
| อัตราชำระ | เปอร์เซ็นต์ที่ชำระแล้ว |

### 3.2 Filter

- ทั้งหมด
- ค้างจ่าย
- ชำระครบ

### 3.3 รายละเอียดสมาชิก

#### ข้อมูลสรุป

| Field | Description |
|-------|-------------|
| จำนวนวง | วงที่เล่นอยู่ |
| จำนวนมือ | มือรวมทุกวง |
| ยอดส่งรวม | รวมที่ส่งมาแล้ว |
| ยอดรับรวม | รวมที่ได้รับแล้ว |
| ค้างจ่าย | ยอดและจำนวนรายการที่ค้าง |
| อัตราชำระ | เปอร์เซ็นต์ที่ชำระแล้ว |

#### รายการค้างจ่าย

แสดงเฉพาะรายการที่ค้าง:

| Field | Description |
|-------|-------------|
| ชื่อวง | วงที่ค้าง |
| งวดที่ | งวดที่ค้าง |
| ยอด | จำนวนเงินที่ค้าง |
| วันเกินกำหนด | จำนวนวันที่เลย |
| Action | ปุ่มทวงถาม |

#### วงที่เล่น

แสดงทุกวงที่สมาชิกเล่น:

| Field | Description |
|-------|-------------|
| ชื่อวง | ชื่อวงแชร์ |
| ประเภท | ประเภทวง |
| จำนวนมือ | มือที่เล่นในวงนี้ |
| สถานะวง | งวดที่ / จบแล้ว |
| ส่งแล้ว | ยอดที่ส่งในวงนี้ |
| รับแล้ว | ยอดที่รับในวงนี้ |
| ค้าง | ยอดที่ค้างในวงนี้ |

#### ประวัติการชำระ

แสดง timeline การชำระ:

| Field | Description |
|-------|-------------|
| วันที่ | วันที่ชำระ |
| สถานะ | ชำระแล้ว / ค้างจ่าย |
| ชื่อวง | วงที่ชำระ |
| งวดที่ | งวดที่ชำระ |
| ยอด | จำนวนเงิน |

---

## 4. สถานะค้างจ่าย (Overdue Status)

### 4.1 ระดับความเร่งด่วน

| สี | วันเกินกำหนด | สถานะ |
|----|--------------|-------|
| 🟠 ส้ม | 1-3 วัน | เพิ่งเลยกำหนด |
| 🔴 แดง | 4+ วัน | เลยกำหนดนาน |

### 4.2 การคำนวณวันเกินกำหนด

```
วันเกินกำหนด = วันปัจจุบัน - วันครบกำหนดชำระ

วันครบกำหนดชำระ = วันที่เริ่มงวด + ระยะห่างงวด
```

---

## 5. API Endpoints

### 5.1 Dashboard

```
GET /api/reports/dashboard
```

Response:
```json
{
  "summary": {
    "totalReceived": 45600,
    "totalPaid": 38400,
    "totalOutstanding": 7200,
    "overdueCount": 3
  },
  "recentOverdue": [
    {
      "memberId": 1,
      "memberName": "เต้ง",
      "groupId": 1,
      "groupName": "วงบ้านเรา",
      "roundNumber": 3,
      "amount": 220,
      "overdueDays": 5
    }
  ],
  "groupCount": 12,
  "memberCount": 48
}
```

### 5.2 รายงานรายวง

```
GET /api/reports/groups
GET /api/reports/groups/:groupId
GET /api/reports/groups/:groupId/rounds
GET /api/reports/groups/:groupId/members
```

### 5.3 รายงานรายคน

```
GET /api/reports/members
GET /api/reports/members/:memberId
GET /api/reports/members/:memberId/groups
GET /api/reports/members/:memberId/payments
```

---

## 6. UI Components

### 6.1 Summary Card

แสดงยอดสรุป 3 ตัว (ยอดรับ, ยอดส่ง, ค้างจ่าย)

### 6.2 Report Card

แสดงข้อมูลวงหรือสมาชิก พร้อมยอดย่อย

### 6.3 Overdue Badge

แสดงจำนวนและสถานะค้างจ่าย

### 6.4 Payment Rate Bar

แสดง progress bar อัตราชำระ

### 6.5 Filter Tabs

Tab สำหรับกรองข้อมูล

---

## 7. Wireframes

### 7.1 Dashboard

```
┌────────────────────────────────────────┐
│  รายงาน                                │
├────────────────────────────────────────┤
│  ┌──────────────────────────────────┐  │
│  │  [Summary Card]                  │  │
│  │  ยอดรับ | ยอดส่ง | ค้างจ่าย       │  │
│  └──────────────────────────────────┘  │
│                                        │
│  ┌────────────┐ ┌────────────┐         │
│  │  📋 รายวง  │ │  👥 รายคน  │         │
│  └────────────┘ └────────────┘         │
│                                        │
│  ─────────── ค้างจ่าย ───────────      │
│  [Overdue List]                        │
└────────────────────────────────────────┘
```

### 7.2 Group List

```
┌────────────────────────────────────────┐
│  ← รายงานรายวง                         │
├────────────────────────────────────────┤
│  [Search Bar]                          │
│  [Filter Tabs]                         │
│                                        │
│  [Report Card - Group 1]               │
│  [Report Card - Group 2]               │
│  [Report Card - Group 3]               │
└────────────────────────────────────────┘
```

### 7.3 Group Detail

```
┌────────────────────────────────────────┐
│  ← ชื่อวง                              │
├────────────────────────────────────────┤
│  [Summary Card]                        │
│                                        │
│  [Tab: รายงวด | รายคน]                 │
│                                        │
│  [Content based on tab]                │
└────────────────────────────────────────┘
```

### 7.4 Member List

```
┌────────────────────────────────────────┐
│  ← รายงานรายคน                         │
├────────────────────────────────────────┤
│  [Search Bar]                          │
│  [Filter Tabs]                         │
│                                        │
│  [Report Card - Member 1]              │
│  [Report Card - Member 2]              │
│  [Report Card - Member 3]              │
└────────────────────────────────────────┘
```

### 7.5 Member Detail

```
┌────────────────────────────────────────┐
│  ← ชื่อสมาชิก                          │
├────────────────────────────────────────┤
│  [Summary Card]                        │
│                                        │
│  ─────────── ค้างจ่าย ───────────      │
│  [Overdue List with Actions]           │
│                                        │
│  ─────────── วงที่เล่น ───────────     │
│  [Group Cards]                         │
│                                        │
│  ─────────── ประวัติการชำระ ─────────  │
│  [Payment Timeline]                    │
└────────────────────────────────────────┘
```

---

*v1.0 | Dec 2024*

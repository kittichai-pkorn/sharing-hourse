# Story 5.4: คำนวณหักรับอัตโนมัติ

## Info
| Field | Value |
|-------|-------|
| Epic | 5. STEP_INTEREST (ขั้นบันได) |
| Priority | P0 |
| Points | 3 (M) |
| Status | Draft |

---

## User Story

```
As a: ท้าวแชร์
I want to: ระบบคำนวณหักรับอัตโนมัติ
So that: ทราบยอดสุทธิที่ผู้เปียจะได้รับ
```

---

## Acceptance Criteria

- [ ] คำนวณหักรับอัตโนมัติเมื่อกำหนดผู้เปีย
- [ ] หักรับ = ยอดส่งของผู้เปีย × (1 + หักท้าย)
- [ ] แสดงยอดรับ, หักรับ, สุทธิ ในตารางงวด
- [ ] งวดท้าวไม่หักรับ (หักรับ = 0)

---

## สูตรคำนวณ

### งวดแรก (ท้าวเปีย)
```
ยอดรับ     = เงินต้น
หักรับ     = 0
ยอดสุทธิ   = ยอดส่งลูกแชร์รวม = 940 บาท
```

### งวดลูกแชร์เปีย
```
ยอดรับ     = เงินต้น = 1,000 บาท
หักรับ     = ยอดส่งของผู้เปีย × (1 + หักท้าย)
ยอดสุทธิ   = ยอดรับ - หักรับ
```

### ตัวอย่าง: เต้เปียงวด 2 (หักท้าย = 1)
```
ยอดรับ     = 1,000 บาท
หักรับ     = 240 × (1 + 1) = 480 บาท
ยอดสุทธิ   = 1,000 - 480 = 520 บาท
```

---

## ตารางงวด

| งวด | ลูกแชร์ | ยอดรับ | หักรับ | สุทธิ | หมายเหตุ |
|-----|---------|--------|--------|-------|----------|
| 1 | ท้าว | 1,000 | 0 | **940** | งวดแรก = ยอดส่งรวม |
| 2 | เต้ | 1,000 | 480 | **520** | 240×2 |
| 3 | เต้ง | 1,000 | 440 | **560** | 220×2 |
| 4 | ทิม | 1,000 | 360 | **640** | 180×2 |
| 5 | ตุ๊ก | 1,000 | 320 | **680** | 160×2 |
| 6 | ต้น | 1,000 | 280 | **720** | 140×2 |
| 7 | ท้าว | 1,000 | 0 | **940** | หักท้าย = ยอดส่งรวม |

> **หมายเหตุ**: ยอดรับ = เงินต้น (1,000 บาท) ทุกงวด

---

## UI/UX

### สี
- ยอดรับ: สีขาว
- หักรับ: สีส้ม (orange)
- สุทธิ: สีเขียว (green)

---

## Files

- `frontend/src/pages/dashboard/ShareGroupDetailPage.tsx`
- `backend/src/services/payout.service.ts`

---

*v1.0 | Dec 2024*

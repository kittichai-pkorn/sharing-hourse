# Story 5.5: งวดหักท้าย

## Info
| Field | Value |
|-------|-------|
| Epic | 5. STEP_INTEREST (ขั้นบันได) |
| Priority | P1 |
| Points | 2 (S) |
| Status | Draft |

---

## User Story

```
As a: ท้าวแชร์
I want to: กำหนดจำนวนงวดหักท้าย
So that: ท้าวได้รับเงินงวดท้ายเพิ่มเติม
```

---

## Acceptance Criteria

- [ ] กำหนดหักท้าย 0-N งวดได้
- [ ] งวดหักท้ายกำหนดให้ท้าวอัตโนมัติ
- [ ] แสดง badge 🟣 หักท้าย
- [ ] คำนวณหักรับรวมงวดหักท้าย

---

## หักท้าย คืออะไร?

> **หักท้าย** = หักยอดส่งงวดสุดท้ายของลูกแชร์ ตอนคำนวณหักรับ

### ตัวอย่าง: หักท้าย = 1 งวด

เมื่อลูกแชร์เปีย จะหักยอดส่งของเขา **รวมงวดสุดท้ายด้วย**

| ผู้เปีย | ยอดส่ง/งวด | หักรับปกติ | หักท้าย (+1) | หักรับรวม |
|---------|------------|------------|--------------|-----------|
| เต้ | 240 | 240 | +240 | **480** |
| เต้ง | 220 | 220 | +220 | **440** |
| ทิม | 180 | 180 | +180 | **360** |
| ตุ๊ก | 160 | 160 | +160 | **320** |
| ต้น | 140 | 140 | +140 | **280** |

---

## สูตร

```
หักรับ = ยอดส่งของผู้เปีย × (1 + หักท้าย)
```

### ตัวอย่าง
- หักท้าย = 0 → หักรับ = ยอดส่ง × 1
- หักท้าย = 1 → หักรับ = ยอดส่ง × 2
- หักท้าย = 2 → หักรับ = ยอดส่ง × 3

---

## Business Logic

### การสร้างงวดหักท้าย
```
จำนวนงวดทั้งหมด = จำนวนมือ + หักท้าย - 1

ตัวอย่าง: 6 สมาชิก + 1 หักท้าย = 6 งวด
- งวด 1: ท้าว (งวดแรก)
- งวด 2-5: ลูกแชร์ 4 คน
- งวด 6: ท้าว (หักท้าย)
```

### หมายเหตุ
- ท้าวได้งวดแรก (อัตโนมัติ)
- ท้าวได้งวดหักท้าย (อัตโนมัติ)
- ลูกแชร์ได้งวดกลาง (กำหนดล่วงหน้า)

---

## Files

- `frontend/src/pages/dashboard/CreateShareGroupPage.tsx`
- `backend/src/services/round.service.ts`

---

*v1.0 | Dec 2024*

# Story 6.2: แสดงรายการหักรับของงวด

## Info
| Field | Value |
|-------|-------|
| Epic | 6. รายการหักรับ |
| Priority | P1 |
| Points | 2 (S) |

---

## User Story

```
As a: ท้าวแชร์
I want to: เห็นรายการหักรับของแต่ละงวด พร้อมระบบ Auto-fill ตามประเภทวง
So that: รู้ว่าหักอะไรบ้าง และไม่ต้องกรอกข้อมูลซ้ำทุกงวด
```

---

## Acceptance Criteria

- [x] แสดงรายการหักรับทั้งหมด
- [x] แสดงดอกเบี้ย (Auto จากประเภทวง)
- [x] แสดงค่าดูแลวง (Auto จาก managementFee)
- [x] แสดงยอดรวมหักรับ
- [x] แสดงเงินที่ผู้ชนะได้รับจริง
- [x] สามารถเพิ่ม/แก้ไข/ลบรายการหักรับเพิ่มเติมได้

---

## Auto-fill Logic ตามประเภทวง

### ดอกเบี้ย (Interest)

| ประเภทวง | การคำนวณดอกเบี้ย |
|---------|-----------------|
| `STEP_INTEREST` (ขั้นบันได) | ดึงจาก `interestRate` ที่กำหนดไว้ในวง × งวดที่ |
| `BID_INTEREST` (บิทดอกตาม) | ดึงจาก `winningBid` (ยอดประมูลที่ชนะ) |
| `FIXED_INTEREST` (ดอกตาม) | ดึงจาก `interestRate` ที่กำหนดไว้ในวง |
| `BID_PRINCIPAL` (บิทลดต้น-หักดอกท้าย) | ดึงจาก `winningBid` (ยอดประมูลที่ชนะ) |
| `BID_PRINCIPAL_FIRST` (บิทลดต้น-หักดอกหน้า) | ดึงจาก `winningBid` (ยอดประมูลที่ชนะ) |

### ค่าดูแลวง (Management Fee)

- ดึงจาก `ShareGroup.managementFee`
- ถ้าไม่มีค่า (null) = ไม่แสดงรายการนี้

### รายการหักรับอื่นๆ

- ดึงจาก `GroupDeductionTemplate` ที่กำหนดไว้ตอนสร้างวง
- สามารถเพิ่ม/แก้ไข/ลบได้ในแต่ละงวด

---

## UI/UX

```
┌─────────────────────────────────────────────────────┐
│  รายการหักรับ - งวดที่ 3                     [X]  │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│                                                     │
│  กำหนดชำระ: 15 ม.ค. 68                              │
│  ผู้ชนะ: พี่เอ                                      │
│                                                     │
│  ┌─────────────────────────────────────────────┐   │
│  │ ดอกเบี้ย (Auto)                    80 บาท  │   │
│  └─────────────────────────────────────────────┘   │
│                                                     │
│  รายการหักรับ                      + เพิ่มรายการ  │
│  ┌─────────────────────────────────────────────┐   │
│  │ [ค่าดูแลวง    ] [  100  ] บาท  [X]         │   │
│  │ [หักท้ายท้าว  ] [  200  ] บาท  [X]         │   │
│  └─────────────────────────────────────────────┘   │
│                                                     │
│  ┌─────────────────────────────────────────────┐   │
│  │ รวมหักรับ:              380 บาท            │   │
│  │ ─────────────────────────────────           │   │
│  │ เงินกองกลาง:         20,000 บาท            │   │
│  │ ผู้ชนะได้รับ:        19,620 บาท            │   │
│  └─────────────────────────────────────────────┘   │
│                                                     │
│  [ปิด]                              [บันทึก]       │
└─────────────────────────────────────────────────────┘
```

---

## Data Flow

```
เมื่อเปิด Modal:
  1. ดึง Round data (winningBid, status, etc.)
  2. ดึง ShareGroup data (type, interestRate, managementFee)
  3. ดึง GroupDeductionTemplate (รายการหักรับ template)
  4. ดึง Deduction ที่บันทึกไว้แล้ว (ถ้ามี)

  5. Auto-fill:
     - ดอกเบี้ย: คำนวณตาม type (read-only, แสดงเป็น info box)
     - ค่าดูแลวง: ถ้ามี managementFee
     - รายการอื่นๆ: จาก template หรือ saved deductions

เมื่อบันทึก:
  1. บันทึก Deduction records ลง DB
  2. อัพเดท Round.payoutAmount (ถ้าต้องการ)
```

---

## API

```
GET /api/deductions/round/:roundId
Response: {
  success: true,
  data: [
    { id: 1, type: "OTHER", amount: 100, note: "ค่าดูแลวง" },
    { id: 2, type: "OTHER", amount: 200, note: "หักท้ายท้าว" }
  ]
}

POST /api/deductions/round/:roundId
Body: {
  deductions: [
    { name: "ค่าดูแลวง", amount: 100 },
    { name: "หักท้ายท้าว", amount: 200 }
  ]
}
```

---

## Technical Notes

- ดอกเบี้ยจะแสดงเป็น read-only (สีเหลือง) เพราะมาจากการประมูลหรือค่าคงที่ของวง
- รายการหักรับอื่นๆ สามารถแก้ไขได้
- เมื่อเปิด Modal ครั้งแรก ถ้ายังไม่มี Deduction ให้ auto-fill จาก GroupDeductionTemplate

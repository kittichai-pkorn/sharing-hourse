# Story 5.11: Tab งวด - วงดอกคงที่ (FIXED_INTEREST)

## Info
| Field | Value |
|-------|-------|
| Epic | 5. จัดการงวด |
| Priority | P1 |
| Points | 3 (M) |
| Status | Todo |

---

## User Story

```
As a: ท้าวแชร์
I want to: ดู tab งวด ที่แสดงข้อมูลเฉพาะสำหรับวงดอกคงที่
So that: เข้าใจดอกเบี้ยและยอดรับของแต่ละงวดได้ถูกต้อง
```

---

## Background

วงดอกคงที่ (FIXED_INTEREST) มีลักษณะเฉพาะ:
- ทุกคนส่ง **ยอดเท่ากัน** ทุกงวด
- มี **ดอกเบี้ยคงที่** ตลอดวง (กำหนดตั้งแต่สร้างวง)
- ท้าวได้งวดแรก (ไม่หักดอก)
- จับฉลากเลือกผู้ชนะ

---

## Acceptance Criteria

- [ ] แสดงคอลัมน์ "ดอกเบี้ย" พร้อมยอดดอกเบี้ยคงที่
- [ ] งวดแรก (ท้าว) แสดงดอกเบี้ย = 0 หรือ "-"
- [ ] งวดอื่นๆ แสดงดอกเบี้ยคงที่ตามที่ตั้งค่าวง
- [ ] สามารถแก้ไขดอกเบี้ยได้ (กรณีต้องการปรับ)
- [ ] แสดงยอดรับจริง (payoutAmount) เมื่อบันทึกผู้ชนะแล้ว

---

## UI/UX - ตาราง tab งวด

```
┌───────┬────────────┬────────┬──────────┬──────────┬──────────┬────────┐
│ งวด   │ กำหนดชำระ  │ สถานะ  │ ผู้ชนะ    │ ดอกเบี้ย  │ ได้รับ    │ จัดการ │
├───────┼────────────┼────────┼──────────┼──────────┼──────────┼────────┤
│ 1     │ 1 ม.ค. 68  │ ✓ สำเร็จ│ ป้าแดง   │ -        │ 10,000   │ [จัดการ]│
│ 2     │ 1 ก.พ. 68  │ ✓ สำเร็จ│ สมชาย    │ 500 ✎    │ 9,400    │ [จัดการ]│
│ 3     │ 1 มี.ค. 68 │ รอ     │ -        │ 500      │ -        │ [จัดการ]│
│ 4     │ 1 เม.ย. 68 │ รอ     │ -        │ 500      │ -        │ [จัดการ]│
└───────┴────────────┴────────┴──────────┴──────────┴──────────┴────────┘
```

**หมายเหตุ:** ✎ = คลิกเพื่อแก้ไขดอกเบี้ย

---

## สูตรคำนวณยอดรับ

### งวดแรก (ท้าว)
```
ยอดรับ = ส่งต่องวด × จำนวนคน
```

**ตัวอย่าง:** 10 คน, ส่งคนละ 1,000
- **ท้าวรับ = 1,000 × 10 = 10,000 บาท**

### งวดอื่นๆ (ลูกแชร์)
```
ยอดรับ = (ส่งต่องวด × จำนวนคน) - ดอกเบี้ย - ค่าดูแลวง
```

**ตัวอย่าง:** 10 คน, ส่งคนละ 1,000, ดอก 500, ค่าดูแล 100
- **ลูกแชร์รับ = 10,000 - 500 - 100 = 9,400 บาท**

---

## การแก้ไขดอกเบี้ย

### เมื่อไหร่แก้ได้
- งวดที่ 2 ขึ้นไป (งวดแรกไม่มีดอก)
- ทุกสถานะ (ทั้งก่อนและหลังมีผู้ชนะ)

### วิธีแก้ไข
1. คลิกที่ตัวเลขดอกเบี้ย
2. แสดง input field แก้ไขได้
3. กด Enter บันทึก / Escape ยกเลิก

```
┌────────────────────────┐
│ 500 ✎  →  [_____] ✓ ✕  │
└────────────────────────┘
```

---

## ความแตกต่างจากประเภทอื่น

| รายการ | FIXED_INTEREST | STEP_INTEREST | BID_INTEREST |
|--------|----------------|---------------|--------------|
| ดอกเบี้ยคงที่ | ใช่ | ไม่มี | ประมูล |
| แสดงคอลัมน์ดอก | ใช่ | ไม่ | ใช่ |
| แก้ไขดอกได้ | ได้ | ไม่ได้ | ได้ |
| Default ดอก | interestRate | - | winningBid |

---

## Technical Notes

### Default Interest Calculation
```typescript
const getDefaultInterest = (round: Round): number => {
  if (round.roundNumber === 1) return 0; // งวดแรกไม่มีดอก
  return group.interestRate || 0; // ดอกคงที่ตลอดวง
};
```

### Display Logic
```typescript
const getDisplayInterest = (round: Round): number | null => {
  if (round.roundNumber === 1) return null;
  if (round.winningBid !== null) return round.winningBid; // ถ้าแก้ไขแล้ว
  return getDefaultInterest(round); // ใช้ค่า default
};
```

---

## Files

- `frontend/src/pages/dashboard/ShareGroupDetailPage.tsx`

---

*v1.0 | Dec 2024*

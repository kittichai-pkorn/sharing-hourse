# Story 5.8: แก้ไขดอกเบี้ยของแต่ละงวด

## Info
| Field | Value |
|-------|-------|
| Epic | 5. จัดการงวด |
| Priority | P2 |
| Points | 1 (XS) |

---

## User Story

```
As a: ท้าวแชร์
I want to: แก้ไขค่าดอกเบี้ยของแต่ละงวดได้ในตารางงวด
So that: ปรับดอกเบี้ยให้ตรงกับความเป็นจริง (กรณีตกลงกันนอกระบบ)
```

---

## Acceptance Criteria

- [ ] สามารถคลิกแก้ไขดอกเบี้ยในตารางงวดได้
- [ ] แสดงค่าดอกเบี้ยที่คำนวณอัตโนมัติเป็นค่าเริ่มต้น
- [ ] บันทึกดอกเบี้ยที่แก้ไขลง database
- [ ] แสดงดอกเบี้ยที่แก้ไขแล้วในตาราง

---

## Current UI - ตารางงวด

```
┌──────┬────────────┬────────┬────────┬──────────┬──────────┬───────────┐
│ งวด  │ กำหนดชำระ   │ สถานะ  │ ผู้ชนะ  │ ดอกเบี้ย  │ ได้รับ    │ จัดการ     │
├──────┼────────────┼────────┼────────┼──────────┼──────────┼───────────┤
│  1   │ 15 ม.ค. 68 │ สำเร็จ │ ป้าแดง │ -        │ 50,000   │ จัดการ    │
│  2   │ 15 ก.พ. 68 │ รอ     │ -      │ 200      │ -        │ จัดการ    │
│  3   │ 15 มี.ค. 68│ รอ     │ -      │ 300      │ -        │ จัดการ    │
└──────┴────────────┴────────┴────────┴──────────┴──────────┴───────────┘
                                        ↑
                                   คลิกแก้ไขได้
```

---

## UI Design: Inline Edit

### สถานะปกติ
```
┌──────┬────────────┬────────┬────────┬──────────┬──────────┬───────────┐
│ งวด  │ กำหนดชำระ   │ สถานะ  │ ผู้ชนะ  │ ดอกเบี้ย  │ ได้รับ    │ จัดการ     │
├──────┼────────────┼────────┼────────┼──────────┼──────────┼───────────┤
│  1   │ 15 ม.ค. 68 │ สำเร็จ │ ป้าแดง │ -        │ 50,000   │ จัดการ    │
│  2   │ 15 ก.พ. 68 │ รอ     │ -      │ 200 ✎   │ -        │ จัดการ    │
│  3   │ 15 มี.ค. 68│ รอ     │ -      │ 300 ✎   │ -        │ จัดการ    │
└──────┴────────────┴────────┴────────┴──────────┴──────────┴───────────┘
                                        ↑
                                   hover แสดง ✎
```

### เมื่อคลิกแก้ไข
```
┌──────┬────────────┬────────┬────────┬───────────────┬──────────┬───────────┐
│  2   │ 15 ก.พ. 68 │ รอ     │ -      │ [___250___] ✓ │ -        │ จัดการ    │
└──────┴────────────┴────────┴────────┴───────────────┴──────────┴───────────┘
                                        ↑
                                   กรอกค่าใหม่ → กด ✓ หรือ Enter บันทึก
                                   กด ESC หรือคลิกนอก → ยกเลิก
```

### States

| State | Display |
|-------|---------|
| ปกติ | `200` (hover แสดง ✎) |
| Editing | `[___250___] ✓` |
| Saving | `250 ⏳` |
| Saved | `250 ✓` (แสดง 1 วินาที) |
| งวดแรก | `-` (ไม่มี icon แก้ไข) |

---

## Database

ไม่ต้องเพิ่ม field ใหม่ - ใช้ `Round.winningBid` ที่มีอยู่

---

## API

### PUT /api/rounds/:id

อัปเดตดอกเบี้ยของงวด (ใช้ API เดิมที่มีอยู่)

```json
// Request
{
  "interest": 250
}

// Response
{
  "success": true,
  "data": {
    "id": 2,
    "roundNumber": 2,
    "winningBid": 250
  }
}
```

---

## Logic

### แสดงดอกเบี้ยในตาราง

```
สำหรับแต่ละงวด:
  ถ้า round.winningBid มีค่า:
    แสดง winningBid
  มิฉะนั้น:
    คำนวณตามประเภทวง:
      - STEP_INTEREST: interestRate × roundNumber
      - FIXED_INTEREST: interestRate
      - BID_*: "-" (รอประมูล)
```

### เมื่อแก้ไข

```
1. แสดง input พร้อมค่าปัจจุบัน
2. ผู้ใช้กรอกค่าใหม่
3. กด save → PUT /api/rounds/:id { interest: value }
4. อัปเดต Round.winningBid
5. Refresh ตาราง
```

---

## Edge Cases

| Case | Behavior |
|------|----------|
| ดอกเบี้ย = 0 | อนุญาต (งวดแรกมักไม่มีดอก) |
| ดอกเบี้ยติดลบ | ไม่อนุญาต (validation) |
| กด ESC / คลิกนอก | ยกเลิกการแก้ไข |
| ค่าว่าง | ใช้ค่า auto-calculate |

---

## Technical Notes

- ใช้ inline edit pattern สำหรับ UX ที่ดี
- ใช้ `winningBid` field เก็บค่าที่แก้ไข
- ถ้า `winningBid = null` → ใช้ค่าคำนวณอัตโนมัติ

# Story 5.10: Tab งวด - วงขั้นบันได (STEP_INTEREST)

## Info
| Field | Value |
|-------|-------|
| Epic | 5. จัดการงวด |
| Priority | P1 |
| Points | 3 (M) |
| Status | ✅ Done |

---

## User Story

```
As a: ท้าวแชร์
I want to: ดู tab งวด ที่แสดงข้อมูลเฉพาะสำหรับวงขั้นบันได
So that: เข้าใจยอดส่งและยอดรับของแต่ละงวดได้ถูกต้อง
```

---

## Background

วงขั้นบันได (STEP_INTEREST) มีลักษณะเฉพาะ:
- แต่ละคนมี **ยอดส่งคงที่ต่างกัน** ตลอดวง
- ไม่มีดอกเบี้ย (ไม่มีคอลัมน์ดอกเบี้ย)
- ท้าวได้งวดแรก รับ = ผลรวมยอดส่งทั้งหมด
- ลูกแชร์รับ = เงินต้น - ยอดส่งคนอื่น - ยอดส่งตัวเอง

---

## Acceptance Criteria

- [x] ไม่แสดงคอลัมน์ "ดอกเบี้ย" (เพราะไม่มีในวงนี้)
- [x] แสดงคอลัมน์ "ยอดส่ง (ผู้ชนะ)" แทน
- [x] แสดงยอดส่งของผู้ชนะในแต่ละงวด (ถ้ามี)
- [x] แสดงยอดรับจริง (payoutAmount) เมื่อบันทึกผู้ชนะแล้ว
- [x] งวดที่ยังไม่มีผู้ชนะ แสดง "-" ในคอลัมน์ยอดส่งและยอดรับ

---

## UI/UX - ตาราง tab งวด

```
┌───────┬────────────┬──────────┬──────────┬──────────┬────────┐
│ งวด   │ กำหนดชำระ  │ ลูกแชร์   │ ยอดรับ    │ ยอดส่ง   │ จัดการ │
├───────┼────────────┼──────────┼──────────┼──────────┼────────┤
│ 1     │ 1 ม.ค. 68  │ ป้าแดง   │ 640      │ 0        │ [จัดการ]│
│ 2     │ 1 ก.พ. 68  │ เต้      │ 360      │ 240      │ [จัดการ]│
│ 3     │ 1 มี.ค. 68 │ -        │ -        │ -        │ [จัดการ]│
│ 4     │ 1 เม.ย. 68 │ -        │ -        │ -        │ [จัดการ]│
└───────┴────────────┴──────────┴──────────┴──────────┴────────┘
```

---

## สูตรคำนวณยอดรับ

### งวดแรก (ท้าว)
```
ยอดรับท้าว = ผลรวมยอดส่งลูกแชร์ทั้งหมด
```

**ตัวอย่าง:**
- เต้ ส่ง 240
- เต้ง ส่ง 220
- ทิม ส่ง 180
- **ท้าวรับ = 240 + 220 + 180 = 640 บาท**

### งวดอื่นๆ (ลูกแชร์)
```
ยอดรับ = เงินต้น - ยอดส่งคนอื่น - ยอดส่งตัวเอง
```

**ตัวอย่าง:** เต้ชนะงวด 2 (เงินต้น 1000)
- ยอดส่งคนอื่น = 220 + 180 = 400
- ยอดส่งตัวเอง = 240
- **เต้รับ = 1000 - 400 - 240 = 360 บาท**

---

## ความแตกต่างจากประเภทอื่น

| รายการ | STEP_INTEREST | FIXED_INTEREST | BID_INTEREST |
|--------|---------------|----------------|--------------|
| คอลัมน์ดอกเบี้ย | ไม่แสดง | แสดง (คงที่) | แสดง (ประมูล) |
| คอลัมน์ยอดส่ง | แสดง | ไม่แสดง | ไม่แสดง |
| แก้ไขดอกได้ | ไม่ได้ | ได้ | ได้ |

---

## Technical Notes

### Frontend Changes
- ตรวจสอบ `group.type === 'STEP_INTEREST'`
- ซ่อนคอลัมน์ "ดอกเบี้ย"
- แสดงคอลัมน์ "ยอดส่ง (ผู้ชนะ)" แทน
- ดึง paymentAmount จาก winner member

### Helper Function
```typescript
const getWinnerPaymentAmount = (round: Round): number | null => {
  if (!group || group.type !== 'STEP_INTEREST' || !round.winnerId) return null;
  const winnerMember = group.members.find(m => m.id === round.winnerId);
  return winnerMember?.paymentAmount ?? null;
};
```

---

## Files

- `frontend/src/pages/dashboard/ShareGroupDetailPage.tsx`

---

*v1.0 | Dec 2024*

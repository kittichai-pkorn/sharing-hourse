# Story 5.9: ปรับการแสดงผลการชำระเงินงวดแรก

## Info
| Field | Value |
|-------|-------|
| Epic | 5. จัดการงวด |
| Priority | P1 |
| Points | 1 (XS) |

---

## User Story

```
As a: ท้าวแชร์
I want to: เห็นรายการชำระเงินงวดแรกที่ถูกต้อง
So that: เข้าใจว่างวดแรกท้าวได้รับเงินอย่างเดียว ไม่ต้องชำระ
```

---

## Background

- งวดแรกเป็นของท้าวแชร์เสมอ (host)
- ท้าวแชร์ไม่ต้องชำระเงินในงวดแรก - รับเงินจากลูกแชร์ทุกคน
- ลูกแชร์ทุกคนต้องชำระเงินให้ท้าว

---

## Current Behavior (ปัจจุบัน)

Tab "การชำระเงิน" งวดแรกแสดงแบบเดียวกับงวดอื่น:
- แสดงท้าวเป็น "🎉 เปียงวดนี้"
- แสดงลูกแชร์อื่นที่ต้องชำระ

**ปัญหา:** อาจสับสนว่าท้าวต้องชำระหรือไม่

---

## Expected Behavior (ที่ต้องการ)

### งวดที่ 1 (ท้าวเปีย)

```
┌─────────────────────────────────────────────────────────────────┐
│  งวดที่ 1 - 15 ม.ค. 68                                    [✕]  │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│                                                                 │
│  [รายการหักรับ]  [การชำระเงิน 0/4]                             │
│  ─────────────────────────────────────────────────────────────  │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  🎉 งวดแรก - ท้าวได้รับเงิน                              │   │
│  │                                                         │   │
│  │  ป้าแดง (ท้าว)                                          │   │
│  │  ได้รับเงิน: 50,000 บาท                                 │   │
│  │  (ไม่ต้องชำระเงินในงวดนี้)                              │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  💰 เงินต้น: 10,000 บาท/คน                                     │
│  ✅ ชำระแล้ว: 0/4 คน (0/40,000 บาท)                           │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ [ ] ป้าเล็ก (M001)       10,000 บาท    ยังไม่ชำระ        │   │
│  │ [ ] น้องแอ๋ม (M002)      10,000 บาท    ยังไม่ชำระ        │   │
│  │ [ ] ลุงสมบัติ (M003)     10,000 บาท    ยังไม่ชำระ        │   │
│  │ [ ] พี่นก (M004)         10,000 บาท    ยังไม่ชำระ        │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  [ปิด]                                         [บันทึก]        │
└─────────────────────────────────────────────────────────────────┘
```

### งวดที่ 2+ (ลูกแชร์เปีย)

```
┌─────────────────────────────────────────────────────────────────┐
│  งวดที่ 2 - 15 ก.พ. 68                                    [✕]  │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│                                                                 │
│  [รายการหักรับ]  [การชำระเงิน 3/4]                             │
│  ─────────────────────────────────────────────────────────────  │
│                                                                 │
│  💰 เงินต้น: 10,000 บาท/คน                                     │
│  ✅ ชำระแล้ว: 3/4 คน (30,000/40,000 บาท)                       │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ [✓] ป้าเล็ก (M001)       10,000 บาท    15 ก.พ. 68 10:30 │   │
│  │ [✓] น้องแอ๋ม (M002)      10,000 บาท    15 ก.พ. 68 11:00 │   │
│  │ [✓] ลุงสมบัติ (M003)     10,000 บาท    15 ก.พ. 68 09:15 │   │
│  │ [ ] พี่นก (M004)         10,000 บาท    ยังไม่ชำระ        │   │
│  │ --- ป้าแดง (ท้าว) ---    🎉 เปียงวดนี้                  │   │  <-- ผู้ชนะ (ท้าว) ยังต้องชำระงวดอื่น
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  [ปิด]                                         [บันทึก]        │
└─────────────────────────────────────────────────────────────────┘
```

---

## Acceptance Criteria

- [ ] งวดแรก: แสดงข้อความพิเศษว่าท้าวได้รับเงิน ไม่ต้องชำระ
- [ ] งวดแรก: ท้าวไม่แสดงในรายการที่ต้องชำระ
- [ ] งวดแรก: แสดงจำนวนเงินที่ท้าวจะได้รับ
- [ ] งวดอื่น: ถ้าท้าวเปียงวดนั้น แสดงเป็น "🎉 เปียงวดนี้" ปกติ
- [ ] งวดอื่น: ถ้าท้าวไม่ได้เปีย ต้องแสดงในรายการที่ต้องชำระ

---

## Logic

### การแสดงผล

```
สำหรับแต่ละงวด:
  ถ้า roundNumber === 1:
    แสดงกล่องพิเศษ "งวดแรก - ท้าวได้รับเงิน"
    แสดงชื่อท้าวและจำนวนเงินที่ได้รับ
    ลูกแชร์ทุกคน (ยกเว้นท้าว) แสดงในรายการชำระ
  มิฉะนั้น:
    แสดงปกติตาม Story 5.7
    ผู้ชนะ (รวมท้าวถ้าเปีย) แสดงเป็น "🎉 เปียงวดนี้"
```

### การคำนวณ

```
งวดแรก:
  totalMembers = จำนวนสมาชิกทั้งหมด - 1 (ไม่รวมท้าว)
  totalAmount = principalAmount × totalMembers
  hostReceives = (principalAmount × maxMembers) - deductions
```

---

## API Changes

ไม่มีการเปลี่ยนแปลง API - ใช้ GET /api/rounds/:roundId/payments เหมือนเดิม

Frontend ต้องตรวจสอบ `roundNumber === 1` และแสดงผลแตกต่าง

---

## Edge Cases

| Case | Behavior |
|------|----------|
| งวดแรก ท้าวเปีย | แสดงกล่องพิเศษ "ท้าวได้รับเงิน" |
| งวดอื่น ท้าวเปีย | แสดง "🎉 เปียงวดนี้" ปกติ |
| งวดอื่น ท้าวไม่ได้เปีย | ท้าวต้องชำระเงินเหมือนลูกแชร์คนอื่น |

---

## Technical Notes

- ตรวจสอบ `selectedRoundForDeduction.roundNumber === 1` ใน frontend
- Filter ท้าว (isHost) ออกจากรายการชำระสำหรับงวดแรก
- แสดง UI พิเศษสำหรับงวดแรก

---

## Files to Modify

- `frontend/src/pages/dashboard/ShareGroupDetailPage.tsx`
  - Tab "การชำระเงิน" ใน Round Deduction Modal
  - เพิ่ม condition check สำหรับ roundNumber === 1

# Story 1.2: เข้าสู่ระบบ (Multi-tenant Login)

## Info
| Field | Value |
|-------|-------|
| Epic | 1. Authentication |
| Priority | P0 |
| Points | 3 (M) |
| Reference | [SUPER_ADMIN_BLUEPRINT.md](../../SUPER_ADMIN_BLUEPRINT.md) Section 7 |

---

## User Story

```
As a: ผู้ใช้ (ท้าวแชร์/ลูกแชร์)
I want to: เข้าสู่ระบบด้วยรหัสวงและข้อมูลส่วนตัว
So that: เข้าถึงข้อมูลวงแชร์ของตัวเอง
```

---

## Authentication Flow

```
┌──────────┐     ┌──────────────┐     ┌─────────────┐
│  Login   │────▶│ Verify Creds │────▶│ Generate    │
│  Page    │     │ + TenantSlug │     │ JWT Token   │
└──────────┘     └──────────────┘     └──────┬──────┘
                                              │
                                              ▼
┌──────────┐     ┌──────────────┐     ┌─────────────┐
│Protected │◀────│   Validate   │◀────│Store Token  │
│  Routes  │     │    Token     │     │localStorage │
└──────────┘     └──────────────┘     └─────────────┘
```

---

## Acceptance Criteria

- [ ] กรอกรหัสวง (tenant slug)
- [ ] กรอกเบอร์โทร/email + รหัสผ่าน
- [ ] ตรวจสอบ Tenant status = ACTIVE
- [ ] แสดง error ถ้าข้อมูลไม่ถูกต้อง
- [ ] แสดง error ถ้า Tenant ยังไม่ได้อนุมัติ
- [ ] จำการ login (Remember me)
- [ ] Redirect ไป Dashboard หลัง login

---

## UI/UX

```
┌─────────────────────────────────────────────────────┐
│  เข้าสู่ระบบ                                        │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│                                                     │
│  รหัสวง *                                          │
│  ┌─────────────────────────────────────────────┐   │
│  │ wong-share-abc                              │   │
│  └─────────────────────────────────────────────┘   │
│                                                     │
│  เบอร์โทร / Email *                                │
│  ┌─────────────────────────────────────────────┐   │
│  │ 0891234567                                  │   │
│  └─────────────────────────────────────────────┘   │
│                                                     │
│  รหัสผ่าน *                                        │
│  ┌─────────────────────────────────────────────┐   │
│  │ ••••••••                                    │   │
│  └─────────────────────────────────────────────┘   │
│                                                     │
│  ☐ จดจำฉัน                                         │
│                                                     │
│  [          เข้าสู่ระบบ          ]                 │
│                                                     │
│  ยังไม่มีบัญชี? ลงทะเบียนท้าวแชร์                   │
└─────────────────────────────────────────────────────┘
```

---

## API

```typescript
POST /api/auth/login

// Request
{
  tenantSlug: string;
  identifier: string;  // phone or email
  password: string;
  rememberMe?: boolean;
}

// Response - Success
{
  success: true,
  data: {
    token: string;
    user: {
      id: string;
      fullName: string;
      email: string;
      role: "ADMIN" | "USER";
    },
    tenant: {
      id: string;
      name: string;
      slug: string;
    }
  }
}

// Response - Error (Tenant not approved)
{
  success: false,
  error: "Tenant ยังไม่ได้รับการอนุมัติ กรุณาติดต่อ Admin"
}
```

---

## JWT Token Payload

```typescript
{
  userId: string;
  tenantId: string;
  role: "ADMIN" | "USER";
  iat: number;
  exp: number;  // 24h or 7d (remember me)
}
```

---

## Error Cases

| กรณี | ข้อความ |
|------|---------|
| ไม่พบรหัสวง | ไม่พบรหัสวงนี้ในระบบ |
| Tenant PENDING | วงยังไม่ได้รับการอนุมัติ |
| Tenant SUSPENDED | วงถูกระงับการใช้งาน |
| ข้อมูลไม่ถูกต้อง | เบอร์โทร/Email หรือรหัสผ่านไม่ถูกต้อง |

---

## Notes

- Multi-tenant: ต้องระบุ tenantSlug เพื่อแยก namespace
- เบอร์โทรเดียวกันสามารถอยู่ในหลาย tenant ได้
- Token แยกตาม tenant
